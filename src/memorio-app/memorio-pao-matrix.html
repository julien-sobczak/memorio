<link rel="import" href="/bower_components/polymer/polymer-element.html">

<link rel="import" href="/bower_components/iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-autocomplete/paper-autocomplete.html">

<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="/src/memorio-app/memorio-card-icon.html">

<dom-module id="memorio-pao-matrix">
  <template>
    <style include="shared-styles">
    :host {
      display: block;
    }

    table {
      max-width: 1280px;
      margin: 0 auto;
    }
    .number {
      padding: 20px;
    }
    .number span {
      padding: 10px;
      border-radius: 50%;
      background-color: #FFE100;
      color: black;
      font-weight: bold;
      display: inline-block;
      width: 18px;
      height: 18px;
    }
    .card {
      padding: 5px 20px;
    }
    </style>

    <!--
    <iron-ajax url="/data/persons.json" auto last-response="{{persons}}"></iron-ajax>
    <iron-ajax url="/data/actions.json" auto last-response="{{actions}}"></iron-ajax>
    <iron-ajax url="/data/objects.json" auto last-response="{{objects}}"></iron-ajax>
    -->

    <paper-tabs selected="{{selected}}">
       <paper-tab>Numbers</paper-tab>
       <paper-tab>Cards</paper-tab>
    </paper-tabs>

    <iron-pages selected="{{selected}}">
      <div>

        <table>
          <tbody>
            <template is="dom-repeat" items="{{_matrixByNumber}}">
              <!-- [[index]] -->
              <tr>
                <th class="number"><span>[[item.number]]</span></th>
                <td class="person">
                  <div class="autocomplete-wrapper">
                    <paper-input id="personInput[[index]]" label="Person" value="[[item.person]]"></paper-input>
                    <!--
                    <paper-autocomplete-suggestions for="personInput[[index]]" source="[[persons]]"
                      text-property="fullName" value-property="fullName"></paper-autocomplete-suggestions>
                    -->
                  </div>
                </td>
                <td class="action">
                  <div class="autocomplete-wrapper">
                    <paper-input id="actionInput[[index]]" label="Action" value="[[item.action]]"></paper-input>
                    <!--
                    <paper-autocomplete-suggestions for="actionInput[[index]]" source="[[actions]]"
                      text-property="text" value-property="text"></paper-autocomplete-suggestions>
                    -->
                  </div>
                </td>
                <td class="object">
                  <div class="autocomplete-wrapper">
                    <paper-input id="objectInput[[index]]" label="Object" value="[[item.object]]"></paper-input>
                    <!--
                    <paper-autocomplete-suggestions for="objectInput[[index]]" source="[[objects]]"
                      text-property="name" value-property="name"></paper-autocomplete-suggestions>
                    -->
                  </div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>

      </div>

      <div>

        <table>
          <tbody>
            <template is="dom-repeat" items="{{_matrixByCard}}">
              <!-- [[index]] -->
              <tr>
                <th class="card"><memorio-card-icon suit="[[item.suit]]" rank="[[item.rank]]"></memorio-card-icon></th>
                <td class="person">
                  <div class="autocomplete-wrapper">
                    <paper-input id="personInput[[index]]" label="Person" value="[[item.person]]"></paper-input>
                    <!--
                    <paper-autocomplete-suggestions for="personInput[[index]]" source="[[persons]]"
                      text-property="fullName" value-property="fullName"></paper-autocomplete-suggestions>
                    -->
                  </div>
                </td>
                <td class="action">
                  <div class="autocomplete-wrapper">
                    <paper-input id="actionInput[[index]]" label="Action" value="[[item.action]]"></paper-input>
                    <!--
                    <paper-autocomplete-suggestions for="actionInput[[index]]" source="[[actions]]"
                      text-property="text" value-property="text"></paper-autocomplete-suggestions>
                    -->
                  </div>
                </td>
                <td class="object">
                  <div class="autocomplete-wrapper">
                    <paper-input id="objectInput[[index]]" label="Object" value="[[item.object]]"></paper-input>
                    <!--
                    <paper-autocomplete-suggestions for="objectInput[[index]]" source="[[objects]]"
                      text-property="name" value-property="name"></paper-autocomplete-suggestions>
                    -->
                  </div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>

      </div>

    </iron-pages>


  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class PaoMatrix extends Polymer.Element {
      static get is() { return 'memorio-pao-matrix'; }

      static get properties() {
        return {
          paoMatrix: {
            type: Object
          },
          persons: {
            type: Array,
            value() {
              return []
            }
          },
          actions: {
            type: Array,
            value() {
              return []
            }
          },
          objects: {
            type: Array,
            value() {
              return []
            }
          },
          selected: {
            type: String,
            value: '0'
          },
          _matrixByNumber: {
            type: Object,
            computed: '_computeMatrixByNumber(paoMatrix)'
          },
          _matrixByCard: {
            type: Object,
            computed: '_computeMatrixByCard(paoMatrix)'
          }
        }
      }

      _computeMatrixByNumber(paoMatrix) {
        let matrixByNumber = [];

        for (let i = 0; i < 100; i++) {
          matrixByNumber[i] = {
            "number": "" + (i + 1),
            "action": "",
            "person": "",
            "object": ""
          };
        }
        for (let i = 0; i < this.paoMatrix.items.length; i++) {
          let item = this.paoMatrix.items[i];
          if (item.number) {
              matrixByNumber[parseInt(item.number) - 1] = item;
          }
        }
        return matrixByNumber;
      }

      _computeMatrixByCard(paoMatrix) {
        let ranks = ['A', 'K', 'Q', 'J', '10', '9', '8', '7', '6', '5', '4', '3', '2'];
        let suits = ['C', 'D', 'H', 'S'];

        let matrixByCard = [];
        let mappingIndexCard = {};

        let i = 0;
        for (let r of ranks) {
          for (let s of suits) {
            let code = r + s;
            mappingIndexCard[code] = i;
            matrixByCard[i++] = {
              "card": code,
              "rank": Card.rankFromCode(code),
              "suit": Card.suitFromCode(code),
              "action": "",
              "person": "",
              "object": ""
            };
          }
        }
        for (let i = 0; i < this.paoMatrix.items.length; i++) {
          let item = this.paoMatrix.items[i];
          if (item.card) {
              matrixByCard[mappingIndexCard[item.card]].person = item.person;
              matrixByCard[mappingIndexCard[item.card]].action = item.action;
              matrixByCard[mappingIndexCard[item.card]].object = item.object;
          }
        }
        return matrixByCard;
      }

    }

    window.customElements.define(PaoMatrix.is, PaoMatrix);
  </script>
</dom-module>
